# –ü—Ä–æ–±–ª–µ–º–∞ —Å Cloudflare Pages Functions

**–î–∞—Ç–∞:** 26 —è–Ω–≤–∞—Ä—è 2026, 03:10 UTC
**–°—Ç–∞—Ç—É—Å:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞

---

## üö® –°–∏–º–ø—Ç–æ–º—ã

1. **API `/api/auth/login` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç error 1101** (Worker threw error)
2. **API `/api/registration` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500**
3. **–õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ–π—Ç–∏ —Å —Å–æ–∑–¥–∞–Ω–Ω—ã–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - 500 –æ—à–∏–±–∫–∞

## ‚úÖ –ß—Ç–æ –†–ê–ë–û–¢–ê–ï–¢

- `/api/registration-count` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"count":0}`
- `/api/news` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `[]`
- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–æ–º–µ–Ω `samarqand-school.org` —Ä–∞–±–æ—Ç–∞–µ—Ç

## ‚ùå –ß—Ç–æ –ù–ï –†–ê–ë–û–¢–ê–ï–¢

- –õ—é–±—ã–µ endpoints –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `.lib.ts` —Ñ–∞–π–ª–æ–≤:
  - `/api/auth/login` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `auth.lib` –∏ `shared.lib`
  - `/api/auth/logout` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `auth.lib` –∏ `shared.lib`
  - `/api/auth/me` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `auth.lib` –∏ `shared.lib`
  - `/api/registration` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `auth.lib`, `email.lib`, `shared.lib`
  - `/api/files` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `auth.lib` –∏ `shared.lib`
  - –í—Å–µ `/api/admin/*` endpoints
  - –í—Å–µ `/api/dev/*` endpoints
  - –í—Å–µ `/api/participant/*` endpoints

---

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**Cloudflare Pages Functions –ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–Æ–¢ –∏–º–ø–æ—Ä—Ç—ã –º–µ–∂–¥—É —Ñ–∞–π–ª–∞–º–∏!**

–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –≤ `/functions/` –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ **–æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Worker** –∏ –Ω–µ –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

### –ü–æ—á–µ–º—É `news.ts` –∏ `registration-count.ts` —Ä–∞–±–æ—Ç–∞—é—Ç?

–≠—Ç–∏ —Ñ–∞–π–ª—ã **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–º–ø–æ—Ä—Ç—ã** - –≤–µ—Å—å –∫–æ–¥ –∏–Ω–ª–∞–π–Ω–µ–Ω:

```typescript
// functions/api/news.ts
interface Env {
  DB: D1Database;
}

const corsHeaders = { /* –∏–Ω–ª–∞–π–Ω */ };

export const onRequest: PagesFunction<Env> = async ({ request, env }) => {
  // –≤–µ—Å—å –∫–æ–¥ –∑–¥–µ—Å—å
};
```

### –ü–æ—á–µ–º—É `login.ts` –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç?

–≠—Ç–æ—Ç —Ñ–∞–π–ª –ø—ã—Ç–∞–µ—Ç—Å—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `auth.lib.ts`:

```typescript
// functions/api/auth/login.ts
import { createSession, createSessionCookie, verifyPassword } from '../auth.lib';
import { corsHeaders, jsonResponse } from '../shared.lib';
// ‚ùå –≠—Ç–∏ –∏–º–ø–æ—Ä—Ç—ã –Ω–µ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –≤ runtime!
```

---

## üí° –†–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò–Ω–ª–∞–π–Ω–∏–Ω–≥ (–ë—ã—Å—Ç—Ä–æ–µ, –Ω–æ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ)

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –∫–æ–¥ –∏–∑ `auth.lib.ts`, `email.lib.ts`, `shared.lib.ts` –≤ –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –∫–æ—Ç–æ—Ä—ã–π –∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç.

**–ü–ª—é—Å—ã:**
- –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É
- –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–ú–∏–Ω—É—Å—ã:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ Worker

### –í–∞—Ä–∏–∞–Ω—Ç 2: Advanced Mode —Å `_worker.js` (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π `functions/_worker.js` –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ API –∑–∞–ø—Ä–æ—Å—ã.

**–ü–ª—é—Å—ã:**
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç—ã –∏ –º–æ–¥—É–ª–∏
- –û–¥–∏–Ω Workers script –¥–ª—è –≤—Å–µ—Ö API
- –õ–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞

### –í–∞—Ä–∏–∞–Ω—Ç 3: Bundler (esbuild/webpack)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–Ω–¥–ª–µ—Ä —á—Ç–æ–±—ã —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π Function file —Å –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

**–ü–ª—é—Å—ã:**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ build pipeline
- –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ CI/CD

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–í–∞—Ä–∏–∞–Ω—Ç 2: Advanced Mode —Å `_worker.js`**

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
functions/
  _worker.js          # –ì–ª–∞–≤–Ω—ã–π Worker —Å —Ä–æ—É—Ç–∏–Ω–≥–æ–º
  _middleware.ts      # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å!
code/samarqand-school/
  src/
    api/              # –û–±—â–∏–π –∫–æ–¥ –¥–ª—è API
      auth.ts
      email.ts
      shared.ts
      handlers/       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ endpoint
        auth-login.ts
        registration.ts
        etc.
```

### –ü—Ä–∏–º–µ—Ä `_worker.js`:

```javascript
import { handleAuth } from './handlers/auth';
import { handleRegistration } from './handlers/registration';
import { handleAdmin } from './handlers/admin';

export default {
  async fetch(request, env, ctx) {
    const url = new URL(request.url);

    // –†–æ—É—Ç–∏–Ω–≥
    if (url.pathname.startsWith('/api/auth/')) {
      return handleAuth(request, env, ctx);
    }
    if (url.pathname === '/api/registration') {
      return handleRegistration(request, env, ctx);
    }
    // ... –∏ —Ç.–¥.

    // Static assets - pass through
    return env.ASSETS.fetch(request);
  }
};
```

---

## üìã –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ):

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å working –≤–µ—Ä—Å–∏—é `/api/auth/login` —Å –∏–Ω–ª–∞–π–Ω–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å working –≤–µ—Ä—Å–∏—é `/api/registration` —Å –∏–Ω–ª–∞–π–Ω–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º
3. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —á—Ç–æ–±—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥–ª–∏ –≤–æ–π—Ç–∏
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

1. ‚è≥ –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å Functions –Ω–∞ Advanced Mode —Å `_worker.js`
2. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å proper —Ä–æ—É—Ç–∏–Ω–≥
3. ‚è≥ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤–µ—Å—å –∫–æ–¥ –∏–∑ `functions/api/` –≤ `_worker.js`
4. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å build pipeline

---

## üîó –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Cloudflare Pages Functions](https://developers.cloudflare.com/pages/functions/)
- [Advanced Mode](https://developers.cloudflare.com/pages/functions/advanced-mode/)
- [Functions Routing](https://developers.cloudflare.com/pages/functions/routing/)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –∏–Ω–ª–∞–π–Ω–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö endpoints (`/api/auth/login` –∏ `/api/registration`)
